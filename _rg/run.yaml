_env:
    - !R.env
        _name    : "define"
        _res :
            - !R.vars
                PRJ_NAME    : "hydra"
            - !R.include
                _path :
                    - "/data/x/etc/mara_env/rigger/mara_v1.yaml"

    - !R.env
        _name : "dev"
        _mix  : "define,_local_deploy,_dev,base"
        _res  :
            - !R.vars
                BASE_DOMAIN : "hydra.${USER}.dev.mararun.com"
                XCC_SDKS    : "${HOME}/devspace/xcc_sdks/src"
                CONF_FILE   : "${PRJ_ROOT}/test/conf.json"

    - !R.env
        _name    : "demo"
        _mix :  "define,_project_deploy,_demo,base"
        _res :
            - !R.vars
                BASE_DOMAIN : "hydra.demo.mararun.cn"
    - !R.env
        _name    : "test"
        _mix :  "define,_project_deploy,_test,base"
        _res :
            - !R.vars
                BASE_DOMAIN : "hydra.demo.mararun.cn"

    - !R.env
        _name : "online"
        _mix  : "define,_project_deploy,_online,base"
        _res  :
            - !R.vars
                BASE_DOMAIN : "hydra.mararun.cn"

    - !R.env
        _name : "base"
        _mix  : "_base"
        _res  :
            - !R.vars
                CONF_FILE    : "/data/x/etc/env_conf/conf/xcc/sdks_conf.json"
                BASE_INCLUDE : "${SDKS_PATH}:${PRJ_ROOT}/src/bizlogic:${PRJ_ROOT}/src/foundation:${PRJ_ROOT}/src/sys_common:${MARA_LIBS}"
                DATA_PATH    : "/data/${RUN_USER}/hydra"
                PORT         : "80"
            - !R.path
                dst  : "${DATA_PATH}"
                keep : True
                sudo : True

_sys:
    -  !R.system
        _name : "dispatch"
        _res  :
            - !R.vars
                PHP_INI  : "${PRJ_ROOT}/conf/used/${SYS_NAME}_php.ini"
            - !R.using
                modul : "mara_php"
                args  : !R.vars
                    INCLUDE_PATH : "${BASE_INCLUDE}:${PRJ_ROOT}/src/sys_${SYS_NAME}"
                    TAG     : "dispatch"
            - !R.daemon_php
                script : "${PRJ_ROOT}/src/sys_${SYS_NAME}/main.php"
                php_ini: "${PHP_INI}"
                tag    : "A"
                # worker : 2
            # - !R.daemon_php
            #     script : "${PRJ_ROOT}/src/sys_${SYS_NAME}/main2.php"
            #     php_ini: "${PHP_INI}"
            #     tag    : "B"




    -  !R.system
        _name : "api"
        _res  :
            - !R.vars
                DOMAIN      : "api.${BASE_DOMAIN}"
                SOCK_FILE   : "${RUN_PATH}/api_fpm.sock"
            - !R.using
                modul : "mara_api"
                args  : !R.vars
                    API_ENTRY    : "${PRJ_ROOT}/src/sys_${SYS_NAME}"
                    INCLUDE_PATH : "${PRJ_ROOT}/src/sys_${SYS_NAME}:${BASE_INCLUDE}"


    -  !R.system
        _name : "test"
        _res  :
            - !R.using
                modul : "mara_unit"
                args  : !R.vars
                    INCLUDE_PATH : "${PRJ_ROOT}/test:${BASE_INCLUDE}"

